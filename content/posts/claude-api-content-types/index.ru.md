---
title: "Типы содержимого сообщений API Claude с пояснениями"
date: 2025-02-18T20:50:05+04:00
slug: "claude-api-content-types"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250218205523451.webp"
tags:
  - "API"
  - "Клод"
  - "LLM"
---

Недавно, изучая API Claude, я обнаружил, что описание типов содержимого сообщений в официальной документации довольно разрозненно. В этой статье мы систематически расскажем о различных типах содержимого, форматах данных и лучших практиках использования API Claude.

<! --подробнее-->

## Обзор структуры сообщений

API Claude поддерживает форматы JSON и XML. Оба формата имеют свои особенности:
- Формат JSON больше подходит для программных вызовов
- Формат XML больше подходит для использования в подсказках

Полная структура сообщения должна содержать:

```mermaid
graph TD
    A[Messages] --> B[系统级配置]
    A --> C[项目指令]
    A --> D[文档内容]
    A --> E[用户消息]
    D --> D1[文本文档]
    D --> D2[PDF文档]
    D --> D3[内容块]
    D --> D4[图片]
```.

## Типы содержимого с пояснениями

API Claude поддерживает следующие типы контента:

### 1. текстовый тип

Самый простой тип текста, поддерживающий обычное текстовое содержимое:

```json
{
  "type": "text",
  "text": "文本内容",
  "source": "source.txt",        // 可选
  "title": "文档标题",           // 可选
  "context": "文档说明"          // 可选
}
```.

### 2. тип pdf

Используется для обработки документов в формате PDF:

```json
{
  "type": "pdf",
  "source": "document.pdf",
  "text": "<base64 encoded content>",
  "context": "PDF document metadata"
}
```

### 3. тип содержимого

Блок содержимого для структурирования:

```json
{
  "type": "content",
  "content": [
    {"text": "第一个内容块"},
    {"text": "第二个内容块"}
  ],
  "source": "structured.txt"
}
```.

### 4. тип изображения

Используется для обработки содержимого изображения:

```json
{
  "type": "image",
  "source": {
    "type": "base64",
    "media_type": "image/jpeg",
    "data": "<base64 encoded image>"
  }
}
```

## Примеры лучших практик

Ниже приведен полный пример вызова API, показывающий, как организовать несколько типов контента:

```python
import anthropic
import base64

client = anthropic.Anthropic()

# 准备 PDF 内容
with open("document.pdf", "rb") as f:
    pdf_content = base64.b64encode(f.read()).decode()

# 准备图片内容
with open("image.jpg", "rb") as f:
    image_content = base64.b64encode(f.read()).decode()

# 创建消息
message = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1024,
    messages=[
        {
            "role": "user",
            "content": [
                # 系统指令
                {
                    "type": "text",
                    "text": "使用以下规则处理文档...",
                    "context": "system instructions",
                    "title": "processing_rules.md"
                },
                # PDF 文档
                {
                    "type": "pdf",
                    "source": "document.pdf",
                    "text": pdf_content,
                    "context": "Main document for analysis"
                },
                # 结构化内容
                {
                    "type": "content",
                    "content": [
                        {"text": "Section 1: Introduction"},
                        {"text": "Section 2: Methods"}
                    ],
                    "source": "outline.txt"
                },
                # 图片
                {
                    "type": "image",
                    "source": {
                        "type": "base64",
                        "media_type": "image/jpeg",
                        "data": image_content
                    }
                },
                # 用户问题
                {
                    "type": "text",
                    "text": "分析上述文档和图片的内容"
                }
            ]
        }
    ]
)
```

Если вы используете форматирование XML в своих подсказках, вы можете организовать их следующим образом:

```xml
<document>
  <source>main_doc.pdf</source>
  <context>主文档内容</context>
  <content>
    <text>文档内容...</text>
    <image>base64编码的图片内容</image>
  </content>
</document>
```

## Ключевые заметки

1. ** Порядок содержания**
   - Системные команды должны быть в самом верху
   - Содержание документации в порядке важности
   - Практические проблемы пользователей - на последнем месте

2. **Использование полей
   - Поле `context` используется для описания метаданных.
   - Поле `title` используется для указания короткого идентификатора.
   - Поле `source` для отслеживания файлов

3. **Оптимизация производительности**.
   - Используйте ссылки на документы, чтобы избежать дублирования содержимого
   - Помните об ограничении размера (32 МБ) для PDF-файлов и изображений.
   - Используйте оперативное кэширование соответствующим образом

## Предложения по использованию

1. **Сохранение согласованности
   - Выберите один из форматов JSON или XML и придерживайтесь его.
   - Последовательность в именовании тегов
   - Последовательное использование ссылок на документы

2. **Структурированное управление
   - Использование вложенных структур для выражения иерархических отношений
   - Организация порядка следования нескольких документов
   - Четкое обозначение типов и назначения документов

3. **Обработка ошибок** Проверьте целостность кодировки base64.
   - Проверка целостности кодировки base64
   - Проверка ограничений на размер файла
   - Обработка исключений при преобразовании форматов

## Заключение

Умелое использование различных типов контента в API Claude может значительно повысить эффективность работы. Главное - понимать особенности и применимые сценарии каждого типа, а также постоянно оптимизировать использование на практике. Надеюсь, эта статья поможет вам лучше использовать API Claude.
