---
title: "Zellij: Модернизация терминального мультиплексора - руководство по переходу с tmux"
date: 2025-03-30T00:48:19+04:00
slug: "zellij-terminal-multiplexer-guide"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250330004913707.webp"
tags:
  - "инструмент разработки"
  - "Терминальные инструменты"
  - "Ржавчина"
  - "Повышение эффективности"
---

Приходилось ли вам открывать множество окон терминала для одновременного выполнения нескольких команд? Или беспокоитесь о потере прогресса каждый раз, когда подключаетесь к серверу по SSH и теряете соединение? Терминальный мультиплексор решает эти проблемы, и Zellij - один из первых, кто начал реализовывать Rust в этой области, предлагая отличный пользовательский опыт и уникальные возможности.

<!--more-->

## 什么是 Zellij？

Zellij - это современный терминальный мультиплексор, написанный на Rust, похожий на tmux или screen, но с более современной философией дизайна и пользовательским интерфейсом. Он позволяет запускать несколько терминальных сессий одновременно в одном окне терминала, а также отсоединять и присоединять сессии без прерывания работы программ.

### 为什么选择 Zellij？

Как для опытных пользователей tmux, так и для новых пользователей, которым требуется мультиплексирование терминалов, Zellij предлагает ряд неоспоримых преимуществ:

1. **Более удобная конфигурация по умолчанию** - работает сразу из коробки, не требует длительной настройки
2. **Интуитивно понятные привязки клавиш** - легче запомнить и использовать
3. **Плавающие панели** - уникальная возможность создания панелей, накладывающихся на основную рабочую область
4. **Мощная система макетов** - декларативная конфигурация, удобная для определения и повторного использования
5. **Улучшенные возможности копирования и вставки** - включая редактирование буфера прокрутки в редакторе

## 从 tmux 迁移到 Zellij

### 安装

На macOS его можно установить с помощью Homebrew:

```bash
brew install zellij
```

В Linux его можно установить с помощью менеджера пакетов или через Cargo:

```bash
cargo install zellij
```

Дополнительные методы установки можно найти в [официальной документации](https://zellij.dev/documentation/installation.html).

### 基础概念对比

| концепции tmux | концепции эквивалентности Zellij | описание |
| ---------| ---------------| ------|
| Сессия | Session | Коллекция окон терминала |
| Окно | Вкладка | Страница представлений, которые можно переключать |
| Pane | Панель | отдельный экземпляр терминала |
| | | Префиксная клавиша (по умолчанию Ctrl+b) | Клавиша переключения режимов (по умолчанию Ctrl+g) | Комбинация клавиш для активации командного режима |

### 主要区别与注意点

Главное отличие Zellij в том, что он использует "систему схем" - аналогично концепции схем в vim:

- **Нормальный режим**: набранное содержимое отправляется непосредственно в терминальное приложение
- **Командный режим**: активируется префиксной клавишей, выполняет действия Zellij
- **Режим прокрутки**: прокрутка истории содержимого.
- **Режим поиска**: поиск содержимого терминала.
- И так далее...

## 为 tmux 用户定制 Zellij

Если вы привыкли к tmux, можно сделать несколько настроек, чтобы сделать нажатие клавиш в Zellij более похожим на tmux. Вот пример конфигурации Zellij для пользователей tmux:

```kdl
// ~/.config/zellij/config.kdl
keybinds {
    normal {
        // 移除默认的 Ctrl+g 前缀
        unbind "Ctrl g"
        // 禁用 Ctrl+s 以避免与文本编辑器冲突
        unbind "Ctrl s"
        // 使用 Ctrl+q 作为前缀键（可改为 Ctrl+b 以匹配 tmux）
        bind "Ctrl q" { SwitchToMode "tmux"; }
    }
    
    tmux {
        // 前缀键按两次发送一次前缀键给应用程序
        bind "Ctrl q" { Write 17; SwitchToMode "normal"; }
        
        // 窗口管理（类似 tmux 的 window）
        bind "c" { NewTab; SwitchToMode "normal"; }
        bind "," { SwitchToMode "RenameTab"; }
        
        // 面板分割（类似 tmux 的 split-window）
        bind "\\" { NewPane "Right"; SwitchToMode "normal"; }
        bind "-" { NewPane "Down"; SwitchToMode "normal"; }
        
        // vim 风格的窗格切换
        bind "h" { MoveFocus "Left"; SwitchToMode "normal"; }
        bind "l" { MoveFocus "Right"; SwitchToMode "normal"; }
        bind "j" { MoveFocus "Down"; SwitchToMode "normal"; }
        bind "k" { MoveFocus "Up"; SwitchToMode "normal"; }
        
        // 会话管理
        bind "d" { Detach; }
        
        // 浮动窗格（Zellij 特有功能）
        bind "w" { ToggleFloatingPanes; SwitchToMode "normal"; }
        
        // 进入复制模式
        bind "[" { SwitchToMode "scroll"; }
    }
    
    // 滚动/复制模式
    scroll {
        // vim 风格的导航
        bind "j" { ScrollDown; }
        bind "k" { ScrollUp; }
        bind "d" { HalfPageScrollDown; }
        bind "u" { HalfPageScrollUp; }
        bind "G" { ScrollToBottom; }
        
        // 复制操作
        bind "y" { Copy; }
        
        // 使用编辑器打开缓冲区
        bind "e" { EditScrollback; SwitchToMode "normal"; }
        
        // 退出复制模式
        bind "q" { SwitchToMode "normal"; }
    }
}

options {
    // MacOS系统设置系统剪贴板集成
    copy_command "pbcopy"
    
    // 防止窗格在命令结束时自动关闭
    pane_close_on_exit false
}
```

## Zellij 布局系统

Одной из изюминок Zellij является система компоновки, которая определяет расположение окон с помощью файла формата KDL:

```kdl
// ~/.config/zellij/layouts/dev.kdl
layout {
    // 默认标签页模板
    default_tab_template {
        // 标签栏
        pane size=1 borderless=true {
            plugin location="zellij:tab-bar"
        }
        // 子窗格内容
        children
        // 状态栏
        pane size=2 borderless=true {
            plugin location="zellij:status-bar"
        }
    }
    
    // 会话名称（可选）
    session_name "dev"
    
    // 系统监控标签页
    tab name="monitor" {
        pane command="htop"
    }
    
    // 编辑标签页
    tab name="editor" {
        pane command="nvim"
    }
    
    // 分割窗格的标签页
    tab name="terminal" {
        pane split_direction="horizontal" {
            pane size="60%"
            pane size="40%" split_direction="vertical" {
                pane
                pane
            }
        }
    }
}
```

Запускается с помощью пользовательского макета:

```bash
zellij --layout dev
```

## 常用快捷键和功能

Ниже приведены общие операции после использования вышеуказанной конфигурации:

### 会话管理

- **Начать новую сессию**: `zellij`.
- **Назовите сессию для запуска**: `zellij -s session name`.
- **Список сессий**: `zellij list-sessions`
- **Присоединиться к сессии**: `zellij attach session-name`.
- **Разделить сессию**: `Ctrl+q d`

### 窗格操作

- **Создайте горизонтальную панель**: `Ctrl+q -`.
- **Создайте вертикальную панель**: `Ctrl+q \`.
- **Переключить фокус панели**: `Ctrl+q`, затем `h/j/k/l` (стиль vim)
- **Изменить размер панели**: `Ctrl+q`, затем клавиши со стрелками
- **Закрыть текущую панель**: `Ctrl+q x`
- **Полный экран текущей панели**: `Ctrl+q z`

### 标签页（Tab）管理

- **Создать новую вкладку**: `Ctrl+q c`.
- **Переименовать вкладки**: `Ctrl+q ,``.
- **Переключение вкладок**: щелкните мышью в строке состояния или используйте клавиши типа `Alt+число`.
- **Перемещение вкладок**: `Ctrl+q Ctrl+j` (вправо) или `Ctrl+q Ctrl+k` (влево)

### 复制模式

- **Вход в режим прокрутки**: `Ctrl+q [`
- **Начать выделение в режиме прокрутки**: `v`
- **Копировать выделение**: `y`
- **Редактировать буфер прокрутки**: `e` в режиме прокрутки
- **Выход из режима прокрутки**: `q` или `Escape`.

### Zellij 特色功能

- **Плавающая панель**: `Ctrl+q w` для переключения видимости плавающей панели
- **Команда запуска плавающей панели**: `zellij run --floating -- command`.
- **Блокировка режима**: `Ctrl+q Ctrl+g`
- **Командный режим**: `Ctrl+q :` Затем введите команду

## 实用案例：开发工作流

Используйте Zellij для создания эффективного рабочего процесса разработки с помощью следующих компонентов:

1. **Мониторинг системы**: htop запускается на отдельной вкладке
2. **Редактор кода**: nvim на основной вкладке
3. **Сборка и тестирование**: разделенная панель для запуска тестов и просмотра результатов
4. **Мониторинг логов**: плавающая панель для просмотра логов в реальном времени

```kdl
// ~/.config/zellij/layouts/dev.kdl
layout {
    default_tab_template {
        pane size=1 borderless=true {
            plugin location="zellij:tab-bar"
        }
        children
        pane size=2 borderless=true {
            plugin location="zellij:status-bar"
        }
    }
    
    session_name "dev"
    
    tab name="monitor" {
        pane command="htop"
    }
    
    tab name="code" {
        pane command="nvim" cwd="/path/to/project"
    }
    
    tab name="build" {
        pane split_direction="horizontal" {
            pane command="sh" {
                args "-c" "echo 'Ready to build'; $SHELL"
            }
            pane command="sh" {
                args "-c" "echo 'Ready to test'; $SHELL"
            }
        }
    }
    
    // 浮动日志窗格
    floating_panes {
        pane command="tail" {
            args "-f" "/path/to/log/file.log"
        }
    }
}
```

## 技巧与陷阱

### 环境变量在布局文件中的处理

Переменные окружения в файлах компоновки Zellij не расширяются автоматически. Лучше всего использовать команду `sh -c`:

```kdl
pane command="sh" {
    args "-c" "tail -f $HOME/logs/app.log"
}
```

### 防止窗格意外关闭

Задайте глобальные параметры или установите их для определенной панели:

```kdl
// 全局设置
options {
    pane_close_on_exit false
}

// 或针对特定窗格
pane close_on_exit=false {
    // ...
}
```

### 复制粘贴最佳实践

Для выполнения сложных операций копирования используйте режим редактора:

1. Войдите в режим прокрутки: `Ctrl+q [`
2. нажмите `e`, чтобы открыть содержимое в редакторе по умолчанию
3. Используйте все возможности редактора (поиск, копирование и т. д.)
4. Сохраните и выйдите обратно в Zellij

## 结语

Zellij предлагает современный опыт и инновационные функции для мультиплексирования терминалов. Он обеспечивает плавный переход для опытных пользователей tmux и снижает барьер для новых пользователей. С помощью конфигураций и руководств, приведенных в этой статье, можно легко начать использовать Zellij для повышения производительности терминалов.

Zellij находится в стадии активной разработки, и в него постоянно добавляются новые функции. Рекомендуется регулярно проверять [официальную документацию](https://zellij.dev/documentation/) для получения последней информации.

Как вы организуете свои сквозные рабочие процессы и какие функции Zellij наиболее полезны для вас? Не стесняйтесь делиться своим опытом в комментариях.