---
title: "Git Reset Advanced: управляйте историей кода как машиной времени!"
date: 2025-02-20T22:09:26+04:00
slug: "git-reset-advance"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250220221107797.webp"
tags:
  - "Git"
  - "инструмент разработки"
  - "Советы и рекомендации"
---

Часто ли вы используете `git reset --hard HEAD~1`, чтобы отменить недавний коммит? Функция сброса в Git'е гораздо мощнее. Сегодня мы рассмотрим расширенные возможности использования Git Reset и увидим, как вы можете управлять историей кода, как машиной времени.

<! ---далее-->

## Начнем с реального сценария

Минг разрабатывает новую функцию и несколько раз комментирует код:

```
$ git reflog
988c685 HEAD@{0}: commit: feature: add image hosting
83c98db HEAD@{1}: commit: fix: update domain redirect
3374901 HEAD@{2}: commit: docs: initial setup
```.

После фиксации он вдруг понимает, что информация в первых двух фиксациях была написана недостаточно хорошо, и хочет ее реорганизовать. В этот момент ему нужно использовать различные режимы Git Reset.

## Три режима Git Reset

Git Reset - это как машина времени, которая не только переносит вас в прошлое, но и позволяет выбрать, что взять с собой, а что оставить. У нее есть три основных режима:

1. __PROTECTED_INLINE_CODE__9__: самый мягкий из сбросов.
   - Перемещается только указатель, все изменения остаются в области постановки.
   - Как машина времени, которая отправляет вас в прошлое, но оставляет все ваши вещи.
   - Хорошо подходит для реорганизации коммитов

2. `--mixed` (режим по умолчанию)
   - Перемещает указатель, изменения остаются в рабочей области, но не ставятся.
   - Как машина времени, которая отправляет вас и ваши вещи в прошлое по отдельности.
   - Хорошо подходит для перепрограммирования того, что вы хотите зафиксировать

3. `--hard`: самый полный сброс.
   - Полностью возвращает к заданному состоянию, отбрасывая все изменения.
   - Это как машина времени, полностью сбрасывающая временную шкалу.
   - Используйте его, когда вы уверены, что хотите отменить определенные изменения.

## Относительные и абсолютные ссылки ##

При использовании Git Reset у нас есть два способа указать целевое местоположение:

1. относительная ссылка: `HEAD~n`.
   ```fish
   git reset --soft HEAD~2  # 回退两个提交
   ```.
   Это все равно что сказать: "Вернитесь на два шага назад".

2. абсолютная ссылка: используйте непосредственно ID коммита
   ```fish
   git reset --hard 988c685  # 直接跳到特定提交
   ```.
   Это все равно что ввести координаты места назначения машины времени.

Практический совет: вам не нужно писать весь ID коммита, Git автоматически заполнит его, если он однозначно идентифицирует коммит.

## Практические советы

### 1. Объедините самые последние коммиты.
```fish
# 回退三个提交，但保留改动
git reset --soft HEAD~3
# 重新提交所有改动
git commit -m "一个更好的提交信息"
```

## 2. Добавьте недостающие файлы.
```fish
# 回退到上一个提交
git reset --soft HEAD^
# 添加遗漏的文件
git add forgotten_file.txt
# 使用原来的提交信息重新提交
git commit -c ORIG_HEAD
```

```fish
# 回退到上一个提交
git reset --soft HEAD^
# 添加遗漏的文件
git add forgotten_file.txt
# 使用原来的提交信息重新提交
git commit -c ORIG_HEAD
``` ### 3. Используйте временные ветки в качестве страховки.
```fish
# 创建临时分支作为保险
git branch temp_backup
# 尝试重置
git reset --hard COMMIT_ID
# 如果效果不是你想要的
git reset --hard temp_backup
```

## Советы по безопасности

1. перед выполнением критической операции сброса можно создать временную ветвь.
2. `ORIG_HEAD` записывает позицию перед опасной операцией и может быть использован для восстановления.
3. Будьте осторожны с `--hard`, так как он отбрасывает все незафиксированные изменения!

## Пример полного рабочего процесса

Давайте рассмотрим полный пример, предположив, что вы хотите реорганизовать два недавних коммита:

```fish
# 1. 先创建临时分支保险
git branch temp_backup

# 2. 使用 soft reset 回退两个提交
git reset --soft HEAD~2

# 3. 检查状态和改动
git status
git diff --cached  # 查看暂存区的改动

# 4. 重新提交
git commit -m "feature: 完整的图片托管功能"

# 5. 确认无误后删除临时分支
git branch -D temp_backup
```.

## Резюме

Сброс Git - мощный инструмент не только для отмены коммитов, но и как "машина времени", помогающая нам отслеживать историю кода. Используя различные режимы и ссылки, мы можем более элегантно управлять историей коммитов.

Помните, что самое важное при работе с Git Reset - это понять, чего вы пытаетесь добиться, а затем выбрать правильный режим для достижения этой цели. Надеюсь, эта статья помогла вам освоить этот мощный инструмент!

```mermaid
graph LR
    A[工作区] --> B[暂存区] --> C[本地仓库]
    D[git reset] --> E["--hard<br/>清空全部"]
    D --> F["--mixed<br/>保留在工作区"]
    D --> G["--soft<br/>保留在暂存区"]
    style D fill:#f9f,stroke:#333,stroke-width:4px
```.
