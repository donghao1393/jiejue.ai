---
title: "Atuin: немного магии в истории команд терминала"
date: 2025-03-29T15:08:52+04:00
slug: "enhance-terminal-history-with-atuin"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250329151034574.webp"
tags:
  - "инструмент командной строки"
  - "Инструменты эффективности"
---

Случалось ли вам набирать сложную команду в терминале, а потом, спустя несколько дней, не помнить ее? Atuin - это инструмент управления историей терминала, который был создан для решения подобных проблем. Он не только записывает ваши команды, но и фиксирует время выполнения, рабочий каталог, статус выполнения и другую контекстную информацию о командах, так что история вашего терминала становится умнее и проще в использовании.

<! --подробнее...

## Почему вам нужен лучший инструмент истории команд?

Представьте себе такой сценарий: Ли - системный администратор, который каждый день выполняет различные задачи по обслуживанию сервера. Однажды ему нужно повторно выполнить определенную команду запроса, которую он использовал две недели назад, но он помнит только, что команда содержит ключевые слова "сеть" и "ошибка".

В традиционном терминале ему пришлось бы сделать примерно следующее. 1:
1. Нажмите `Ctrl+R`, чтобы начать обратный поиск. 2.
2. введите "network" и продолжайте нажимать `Ctrl+R` в надежде найти команду.
3. если вы не нашли ее, попробуйте ввести другое ключевое слово.
4. возможно, в итоге вам придется вручную просмотреть всю историю.

С помощью Atuin Ли нужно только:
1. нажать `Ctrl+R`, чтобы перейти к полноэкранному экрану поиска. 2.
2. ввести "ошибка сети".
3. сразу же увидеть все подходящие команды с указанием времени выполнения, каталога и другой информации.
4. выберите нужную команду и выполните ее

Это огромное улучшение эффективности командной строки!

## Что такое Atuin?

Atuin (произносится "ах-то-ин") - это инструмент с открытым исходным кодом, который использует базу данных SQLite вместо традиционных текстовых файлов для хранения истории командной строки. В отличие от традиционной истории, Atuin записывает больше информации:

- время выполнения команды
- рабочий каталог, в котором была выполнена команда
- код состояния выхода команды (успех или неудача)
- продолжительность выполнения
- Имя хоста и информация о сеансе

Такая конструкция позволяет выполнять более интеллектуальный поиск и фильтры на основе этой дополнительной информации.

```mermaid
graph TD
    A[传统历史记录] --> B[只存储命令文本]
    C[Atuin历史记录] --> D[存储命令文本]
    C --> E[存储执行时间]
    C --> F[存储工作目录]
    C --> G[存储退出状态]
    C --> H[存储执行时长]
    C --> I[存储主机信息]
```_.

## Быстрое начало работы с Atuin

### Установка

Самый простой способ установить Atuin - использовать официальный скрипт установки:

```bash
curl --proto '=https' --tlsv1.2 -LsSf https://setup.atuin.sh | sh
```.

Кроме того, вы можете установить его с помощью менеджера пакетов:

- macOS: `brew install atuin`.
- Arch Linux: `pacman -S atuin`.
- через Cargo: `cargo install atuin`.

### Настройка оболочки

После установки необходимо добавить команды инициализации Atuin в конфигурационный файл оболочки:

Для Bash добавьте в `~/.bashrc`:
```bash
eval "$(atuin init bash)"
```

Для Zsh добавьте в `~/.zshrc`:
```bash
eval "$(atuin init zsh)"
```

Для Fish добавьте в `~/.config/fish/config.fish`:
```fish
atuin init fish | source
```

### Импортируйте существующую историю

После установки и настройки Atuin вы можете импортировать существующую историю оболочки:

```bash
atuin import auto
```

Эта команда автоматически определит тип вашей оболочки и импортирует соответствующую историю.

## Базовое использование Atuin

### История поиска

Самой основной и мощной функцией Atuin является поиск в истории. По умолчанию он заменяет сочетание клавиш `Ctrl+R` и стрелку вверх.

После нажатия `Ctrl+R` перед вами откроется полноэкранный экран поиска, на котором вы можете ввести ключевые слова для поиска. В результатах поиска будут показаны совпадающие команды и соответствующая контекстная информация.

![Atuin 搜索界面示例](https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250329151306974.webp)

На экране поиска вы можете:

- `Enter` Использовать клавишу `Enter` для выполнения выбранной команды.
- Отредактировать выбранную команду с помощью клавиши `Tab`.
- Используйте клавишу `Alt+数字` для быстрого выбора определенного результата (например, `Alt+1` для выбора первого результата).
- Нажмите `Ctrl+R` несколько раз для переключения между различными режимами фильтрации (глобальный/хост/сессия/директория).

### Поиск и фильтрация в командной строке

В дополнение к интерактивному интерфейсу вы можете искать и фильтровать историю непосредственно из командной строки:

```bash
# 简单搜索
atuin search git commit

# 按退出状态码过滤（只显示成功的命令）
atuin search --exit 0 git commit

# 按工作目录过滤
atuin search --cwd ~/projects

# 按时间范围过滤
atuin search --after "yesterday 3pm" --before "today"
```

### Статистика

Atuin также предоставляет статистические функции, чтобы помочь вам понять привычки использования вашего терминала:

```bash
# 显示基本统计信息
atuin stats

# 查看今天的统计
atuin stats today

# 查看本周的统计
atuin stats week
```

Эта статистика поможет вам понять наиболее часто используемые команды, среднее время выполнения команд и другую информацию.

## Советы по расширенному использованию

### Настройка формата вывода

Вы можете настроить формат вывода с помощью параметра `--format`:

```bash
atuin search --format "{time} - [{duration}s] - {directory}$ {command}"
```

Доступные переменные формата включают:
- `{command}` - Текст команды.
- `{exit}` - код состояния выхода
- `{duration}` - время выполнения (секунды)
- `{time}` - время выполнения
- `{directory}` или `{cwd}` - рабочий каталог
- `{host}` или `{hostname}` - имя хоста.
- `{user}` - имя пользователя
- __PROTECTECTED_INLINE_CODE_38__ - идентификатор сеанса
- `{relativetime}` - относительное время (например, "2 часа назад")

### Синхронизация с несколькими устройствами

Если вы работаете на нескольких устройствах, Atuin может зашифровать и синхронизировать вашу историю:

```bash
# 注册账户
atuin register -u <用户名> -e <邮箱>

# 同步历史记录
atuin sync
```

Все синхронизированные данные шифруются из конца в конец, чтобы сохранить вашу историю в безопасности.

## Практические сценарии применения

### Повседневная работа разработчика

Разработчикам программного обеспечения Atuin может помочь:

1. быстро найти команды, которые были успешно скомпилированы или развернуты ранее.
2. просмотреть все команды, которые были выполнены в определенном каталоге проекта
3. проанализировать, какие команды выполняются дольше всего, чтобы оптимизировать рабочий процесс.

### Задачи системного администратора

Для системных администраторов Atuin может помочь вам:

1. записывать и легко извлекать сложные команды конфигурации системы
2. отслеживать команды, которые были выполнены на определенном сервере
3. находить и повторно использовать команды, которые успешно решали системные проблемы.

### Работа по анализу данных

Для аналитиков данных Atuin может помочь вам:

1. сохранять и быстро извлекать сложные запросы на обработку данных
2. различать команды, выполняемые на разных наборах данных.
3. отслеживать время выполнения задач обработки данных и выявлять узкие места в производительности.

## Часто задаваемые вопросы

### Как очистить историю неудачных команд?

Если вы хотите очистить историю от неудачных команд (код состояния выхода ненулевой), вы можете использовать следующую команду:

```bash
# 删除所有退出状态码不为0的命令
atuin search --delete --exclude-exit 0
```.

### Где хранится история?

История Atuin хранится в базе данных SQLite, обычно расположенной по адресу:
- Linux: `~/.local/share/atuin/history.db`.
- Linux: `~/.local/share/atuin/history.db` macOS: `~/.local/share/atuin/history.db`
- Windows: `%APPDATA%\atuin\history.db`

### Как создать резервную копию данных Atuin?

Самый простой способ - скопировать весь каталог данных Atuin:

```bash
cp -r ~/.local/share/atuin/ ~/backup/atuin/
```.

## Резюме

Atuin добавляет мощные возможности к традиционной истории терминала, позволяя вам находить и повторно использовать команды более эффективно. К его основным преимуществам относятся:

1. мощный поиск с контекстной информацией
2. удобный полноэкранный интерфейс поиска
3. гибкие возможности фильтрации
4. полезная статистика
5. зашифрованная синхронизация между устройствами

Независимо от того, являетесь ли вы разработчиком, системным администратором или аналитиком данных, Atuin может значительно повысить производительность ваших конечных устройств. Все, что вам нужно сделать, - это потратить несколько минут на его установку и настройку, а затем наслаждаться его удобством.

Вы когда-нибудь задумывались, какие рабочие процессы можно создать, если объединить контекстно-зависимый поиск Atuin с другими инструментами командной строки? Например, передавать результаты поиска непосредственно в другие инструменты или автоматически генерировать сценарии для общих действий на основе истории? Почему бы не попробовать и не изучить новые возможности?
