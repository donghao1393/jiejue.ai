---
title: "Магия извлечения данных: 5 минут, чтобы научиться использовать командную строку для обработки сложных журналов"
date: 2025-07-26T15:32:34+04:00
slug: "ripgrep-data-extraction-quick-guide"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250726153651688.webp"
tags:
  - "Командная строка (вычислительная техника)"
  - "обработка данных"
  - "эффективность работы"
  - "ripgrep"
---

Приходилось ли вам сталкиваться со сценарием, когда начальник просит вас найти конкретные данные из тысяч строк журналов инвентаризации, например количество товаров на складе и модели продуктов, а затем свести их в таблицу? Ручное копирование и вставка не только неэффективны, но и чреваты ошибками. Сегодня я расскажу вам о суперполезном трюке командной строки, позволяющем выполнить подобную задачу извлечения данных за несколько минут.

<! ---далее-->

## Сценарий реального мира: проблемы менеджера склада Ли

Менеджер склада Ли недавно получил задание: извлечь из журнала системы инвентаризации данные о количестве и типе продаваемых товаров и свести их в отчет. Файл журнала выглядит следующим образом:

```
商品ID: SKU001  状态: available  库存信息: {'stock': 1500, 'productType': 'laptop-pro'}
商品ID: SKU002  状态: discontinued  库存信息: {'stock': 250, 'productType': 'tablet-mini'}
...
```

Если вы используете традиционный метод, Ли необходимо:
1. открыть файл в текстовом редакторе
2. вручную найти строки, содержащие слово "available".
3. скопировать информацию об инвентаре и товарах построчно
4. вставить ее в таблицу

Это не только утомительно, но и легко пропустить или сделать ошибку.

## Решение: извлечение данных в три шага

### Первый шаг: найти целевые данные.

Используйте ripgrep (инструмент быстрого поиска), чтобы отфильтровать строки, содержащие "available", из файла:

```bash
cat 库存日志.txt | rg available
```_.

На этом шаге отображаются все записи о товаре, который доступен для продажи.

### Шаг 2: Извлечение необходимой информации

Далее извлеките номера складов и модели товаров:

```bash
cat 库存日志.txt | rg available | rg -o "'stock': \d+,|'productType': '[\w-]*?'"
```

Эта команда действует как "умное сито":
- `rg -o` означает "показывать только совпадения".
- `'stock': \d+,` соответствует информации об инвентаре (числовая часть).
- `|` означает "или".
- `'productType': '[\w-]*?'` Соответствует номеру модели продукта.

Теперь вы увидите вывод, похожий на этот:
```
'stock': 1500,
'productType': 'laptop-pro'
'stock': 250,
'productType': 'tablet-mini'
```.

### Шаг 3: Упорядочить в табличный формат

Используйте команду paste, чтобы поместить парную информацию в одну строку:

```bash
cat 库存日志.txt | rg available | rg -o "'stock': \d+,|'productType': '[\w-]*?'" | paste - -
```

В результате получится:
```
'stock': 1500,     'productType': 'laptop-pro'
'stock': 250,      'productType': 'tablet-mini'
```.

## Что делать, если вы столкнулись с нечистыми данными?

Иногда данные журнала бывают неполными, например, в некоторых записях отсутствует информация об инвентаризации. В этом случае вывод может быть неправильным:

```
'productType': 'laptop-pro'     'stock': 1500,
'productType': 'monitor-4k'     'stock': 250,
```

**Решение**: Добавьте идентификатор продукта во время извлечения, чтобы сформировать три столбца данных:

```bash
cat 库存日志.txt | rg available | rg -o " ([A-Z]{3}\d{3}) |'stock': \d+,|'productType': '.*?'" | paste -d "," - - - | column -t -s ","
```

Таким образом, даже если какое-либо поле отсутствует, соответствие данных может быть сохранено по идентификатору продукта.

## Практические советы Резюме

1. **Запомните эту универсальную формулу**: __PROTECTED_INLINE_CODE__12__.

2. **Обычно используемые правила извлечения**:
   - Извлечение чисел: `\d+`
   - Извлечение слов: `\w+`
   - Извлечение содержимого инвертированных запятых: `'.*?'`

3. **Параметры форматирования**:
   - `paste - -` два столбца рядом
   - `paste -d "," - -` разделенные запятыми.
   - `column -t` Выровнять столбцы.

## Почему это так хорошо работает?

В основе этого подхода лежит "конвейерное мышление": разбиение сложных задач на простые шаги, где каждый инструмент делает что-то одно, но их сочетание дает мощный эффект. Это похоже на заводской сборочный конвейер, с четким разделением труда на каждом этапе, что приводит к высококачественным результатам.

Освоив эту технику, независимо от того, работаете ли вы с инвентарными журналами, анализируете данные о продажах или сортируете заказы клиентов, вы сможете быстро извлекать нужную информацию и значительно повысить эффективность своей работы!

В следующий раз, когда вы столкнетесь с подобными задачами по извлечению данных, не забудьте попробовать этот метод. Вы увидите, что работа, на которую раньше уходили часы, теперь может быть выполнена за считанные минуты.
