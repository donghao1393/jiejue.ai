---
title: "Идеальная синхронизация файлов с помощью Rsync: исчерпывающее руководство от новичка до продвинутого пользователя"
date: Thu Mar 27 2025 18:47:42 GMT+0000 (Coordinated Universal Time)
slug: "perfect-file-sync-with-rsync"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250327225522772.webp"
tags:
  - "Инструменты эффективности"
  - "Управление документами"
  - "Командная строка (вычислительная техника)"
---

Вам когда-нибудь приходилось переносить большое количество файлов между двумя компьютерами? Или вам нужно создать резервную копию важных данных, но вы боитесь потерять атрибуты файлов (например, время модификации и разрешения)? Представленный сегодня инструмент rsync может не только решить эти проблемы, но и сделать передачу файлов более быстрой и надежной. Независимо от того, являетесь ли вы обычным пользователем или профессионалом, это руководство поможет вам легко освоить этот мощный инструмент.

<!--more-->

## 什么是rsync？

rsync (remote synchronization, удаленная синхронизация) - широко распространенный инструмент синхронизации файлов в Unix-подобных системах (включая macOS). Он позволяет эффективно передавать и синхронизировать файлы между локальными файловыми системами или между компьютерами по сети.

Проще говоря, rsync - это умный мувер (инструмент для передачи файлов), который специально:
- копирует только файлы с изменениями, экономя время и пропускную способность сети
- он может сохранять исходные свойства файлов (временные метки, разрешения и т. д.)
- Поддерживает возобновление точек останова, поэтому вы можете возобновить работу с точки останова после того, как передача была прервана.
- Обеспечивает подробное отображение хода выполнения

## 为什么要用rsync？

Представьте себе эти сценарии:

- **Дизайнеру Сяо Вану** необходимо копировать готовые файлы с рабочего компьютера на резервный жесткий диск дома, но копирование через USB слишком медленное и часто теряется время создания файла.
- **Бухгалтер Сестра Ли** должна еженедельно создавать резервные копии своих финансовых данных, но хочет, чтобы дата модификации файлов резервных копий оставалась неизменной, чтобы можно было отслеживать историю файлов
- **Студент Сяо Чэнь** часто синхронизирует учебные материалы между двумя компьютерами, но из-за нестабильности сети передача данных прерывается, и каждый раз приходится начинать заново

Во всех этих случаях rsync прекрасно решает проблему.

## 开始使用rsync前的准备

### 安装最新版本

Версия rsync, поставляемая с macOS, устарела и имеет ограниченную функциональность. Рекомендуется установить последнюю версию через Homebrew:

```bash
brew install rsync
```

После установки вы можете проверить версию с помощью следующей команды:

```bash
rsync --version
```

Если отображается номер версии 3.x.x (например, 3.2.x или выше), то поздравляем, вы можете использовать все расширенные возможности, описанные в этой статье!

### 了解基本命令结构

Основной формат команд для rsync следующий:

```bash
rsync [选项] 源路径 目标路径
```

## rsync基础：简单实用的同步命令

### 最基础的同步命令

```bash
rsync -av 源文件夹/ 目标文件夹/
```

В этой команде:
- `-a` - это "режим архива", который сохраняет почти все атрибуты файлов.
- `-v` означает "подробный вывод" и показывает копируемые файлы.

Например, синхронизация "Моих документов" с внешним жестким диском:

```bash
rsync -av "~/Documents/" "/Volumes/ExternalDrive/Documents/"
```

### 添加进度显示

При синхронизации больших файлов или большого количества файлов важно знать о ходе выполнения:

```bash
rsync -av --progress 源文件夹/ 目标文件夹/
```

## 进阶技巧：让rsync完全满足你的需求

### 不同的进度显示方式

rsync предлагает множество вариантов отображения прогресса для различных сценариев:

1. **`--progress`**：显示每个文件的传输进度
   ```bash
   rsync -av --progress 源文件夹/ 目标文件夹/
   ```
   适合：想看到每个文件详细进度的场景

2. **`--info=progress2`**（推荐，需要新版rsync）：显示总体传输进度
   ```bash
   rsync -av --info=progress2 源文件夹/ 目标文件夹/
   ```
   适合：同步大量文件时，只想看整体进度

3. **`-P`**：这是`--progress --partial`的组合，允许断点续传并显示进度
   ```bash
   rsync -avP 源文件夹/ 目标文件夹/
   ```
   适合：网络不稳定环境下的传输

### 保持原始时间戳和属性

Иногда вы можете обнаружить, что время модификации файла становится текущим временем после синхронизации. Этого можно избежать, если использовать правильные параметры:

```bash
rsync -avt 源文件夹/ 目标文件夹/
```

Среди них:
- `-t' используется исключительно для сохранения времени модификации файла

Для пользователей Mac можно также добавить опцию `-E`, чтобы сохранить атрибуты файлов, специфичные для macOS:

```bash
rsync -avtE 源文件夹/ 目标文件夹/
```

### 镜像同步（删除目标中多余的文件）

Если вы хотите, чтобы целевая папка точно соответствовала исходной (удалите из целевой папки файлы, которых нет в исходной):

```bash
rsync -av --delete 源文件夹/ 目标文件夹/
```

⚠️ Пожалуйста, будьте осторожны с опцией `--delete`, она удалит файлы в целевом расположении, которых нет в исходном расположении.

### 先测试，再执行

Перед выполнением критической синхронизации можно использовать проход с опцией `--dry-run`:

```bash
rsync -av --dry-run 源文件夹/ 目标文件夹/
```

Это покажет действие, которое будет выполнено, но на самом деле не будет выполнено.

### 排除特定文件或文件夹

Исключите файлы, которые не нужно синхронизировать:

```bash
rsync -av --exclude='*.tmp' --exclude='temp/' 源文件夹/ 目标文件夹/
```

## rsync如何工作：了解原理

rsync эффективен, потому что использует умный алгоритм для распознавания изменений файлов.

```mermaid
flowchart TD
    A[开始同步] --> B{检查文件是否存在于目标}
    B -->|否| C[完整复制文件]
    B -->|是| D{检查文件大小和修改时间}
    D -->|不同| E[计算文件差异]
    D -->|相同| F[跳过文件]
    E --> G{传输差异块}
    G --> H[在目标重建完整文件]
    C --> Z[继续下一个文件]
    F --> Z
    H --> Z
    Z --> I{还有更多文件?}
    I -->|是| B
    I -->|否| J[同步完成]
```

Этот метод инкрементной передачи значительно повышает эффективность, поскольку передается только та часть файла, которая изменилась. Например, если в файле объемом 10 ГБ было изменено всего несколько МБ, rsync передаст только эти несколько МБ данных.

## 常见场景的最佳实践

### 场景一：备份重要文档

Сохраняет все атрибуты и показывает общий прогресс:

```bash
rsync -avE --info=progress2 ~/Documents/ /Volumes/Backup/Documents/
```

### 场景二：同步两台Mac之间的文件夹

Сетевая среда нестабильна и требует прерывистой и сжатой передачи данных:

```bash
rsync -avzP ~/Projects/ user@remote-mac:~/Projects/
```

### 场景三：创建完全镜像的备份

Полная синхронизация зеркал с сохранением всех атрибутов:

```bash
rsync -avE --delete --info=progress2 ~/Pictures/ /Volumes/Backup/Pictures/
```

## 排查常见问题

1. **Проблемы с правами доступа к файлам**: Если у вас возникла ошибка с правами доступа, попробуйте выполнить команду с `sudo'
2. **Изменения временной метки**: убедитесь, что вы используете опцию `-a` или `-t`!
3. **Слишком медленно**: добавьте опцию `-z`, чтобы включить сжатие.
4. **Дополнительные опции не найдены**: проверьте версию rsync, возможно, ее нужно обновить!

## 总结

rsync - это очень мощный инструмент синхронизации файлов, освоение которого может значительно повысить эффективность работы с файлами. Мы надеемся, что это руководство поможет вам максимально использовать возможности rsync: от простого резервного копирования до сложной удаленной синхронизации, от базового использования до расширенных опций.

Если вы дизайнер, которому необходимо создать резервную копию своей работы, бухгалтер, которому нужно сохранить финансовые данные, или студент, которому нужно синхронизировать учебные материалы на нескольких устройствах, rsync удовлетворит все ваши требования к синхронизации файлов.

## 思考问题

Если вы регулярно синхронизируете файлы между несколькими устройствами, попробуйте создать простой сценарий для автоматизации этого процесса. Как вы думаете, каковы преимущества и недостатки rsync по сравнению с другими программами резервного копирования для выполнения регулярных задач резервного копирования? Как бы вы на практике сбалансировали автоматизацию и безопасность данных?