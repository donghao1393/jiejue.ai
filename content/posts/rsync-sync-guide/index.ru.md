---
title: "Идеальная синхронизация файлов с помощью Rsync: исчерпывающее руководство от новичка до продвинутого пользователя"
date: 2025-03-27T22:47:42+04:00
slug: "perfect-file-sync-with-rsync"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250327225522772.webp"
tags:
  - "Инструменты эффективности"
  - "Управление документами"
  - "Командная строка (вычислительная техника)"
---

Вам когда-нибудь приходилось переносить большое количество файлов между двумя компьютерами? Или вам нужно создать резервную копию важных данных, но вы боитесь потерять атрибуты файлов (например, время модификации и разрешения)? Представленный сегодня инструмент rsync может не только решить эти проблемы, но и сделать передачу файлов более быстрой и надежной. Независимо от того, являетесь ли вы обычным пользователем или профессионалом, это руководство поможет вам легко освоить этот мощный инструмент.

<! --подробнее-->

## Что такое rsync?

rsync (remote synchronization, удаленная синхронизация) - это широко используемый инструмент синхронизации файлов в Unix-подобных системах (включая macOS). Он позволяет эффективно передавать и синхронизировать файлы между локальными файловыми системами или между различными компьютерами по сети.

В двух словах, rsync - это как умный мувер (инструмент для передачи файлов), который специально:
- копирует только файлы с изменениями, экономя время и пропускную способность сети
- он может сохранять исходные свойства файлов (временные метки, разрешения и т. д.)
- Поддерживает возобновление работы с точки останова, поэтому вы можете возобновить работу с точки останова после того, как передача была прервана.
- Обеспечивает подробное отображение хода выполнения

## Почему стоит использовать rsync?

Представьте себе такие сценарии:

- **Дизайнер Сяо Ван** должен копировать готовые файлы с рабочего компьютера на домашний резервный жесткий диск, но копирование через USB слишком медленное и часто теряет время создания файла.
- **Бухгалтеру Сестре Ли** необходимо еженедельно создавать резервные копии финансовых данных, но она хочет, чтобы дата модификации файлов резервных копий оставалась неизменной, чтобы можно было отслеживать историю файлов
- **Студент Сяо Чэнь** часто синхронизирует учебные материалы между двумя компьютерами, но из-за нестабильности сети передача данных прерывается, и каждый раз приходится начинать заново

Во всех этих случаях rsync отлично решает проблему.

## Подготовка перед началом использования rsync

### Установите последнюю версию

Версия rsync, поставляемая с macOS, устарела и имеет ограниченный функционал. Рекомендуется установить последнюю версию через Homebrew:

```bash
brew install rsync
```.

После установки вы можете проверить версию с помощью следующей команды:

```bash
rsync --version
```

Если отображается версия 3.x.x (например, 3.2.x или выше), то поздравляем, вы можете использовать все расширенные возможности, описанные в этой статье!

### Понимание базовой структуры команд

Основной формат команд для rsync следующий:

```bash
rsync [选项] 源路径 目标路径
```.

## Основы rsync: простые и полезные команды синхронизации

### Самые основные команды синхронизации

```bash
rsync -av 源文件夹/ 目标文件夹/
```

в этой команде:
- `-a` - это "архивный режим", который сохраняет почти все атрибуты файлов.
- `-v` означает "Подробный вывод" и отображает копируемые файлы.

Например, синхронизация "Моих документов" с внешним жестким диском:

```bash
rsync -av "~/Documents/" "/Volumes/ExternalDrive/Documents/"
``` означает "подробный вывод", который показывает копируемый файл.

### Добавить отображение прогресса

При синхронизации больших файлов или большого количества файлов важно знать о ходе выполнения:

```bash
rsync -av --progress 源文件夹/ 目标文件夹/
```

## Продвинутый совет: Заставьте rsync делать именно то, что вам нужно

### Различные способы отображения прогресса

rsync предоставляет множество вариантов отображения прогресса для различных сценариев:

1. **`--progress`*: Отображение прогресса передачи каждого файла.
   ```bash
   rsync -av --progress 源文件夹/ 目标文件夹/
   ```.
   Подходит для: сценариев, в которых необходимо видеть подробный прогресс каждого файла

2. **`--info=progress2`** (рекомендуется, требует более новых версий rsync): отображение общего прогресса передачи.
   ```bash
   rsync -av --info=progress2 源文件夹/ 目标文件夹/
   ```
   Подходит для: синхронизации большого количества файлов, когда вы просто хотите увидеть общий прогресс.

3. **__PROTECTED_CODE_INLINE_CODE_22__**: это комбинация __PROTECTED_CODE_INLINE_CODE_23__, позволяющая осуществлять прерывистые передачи и показывать прогресс.
   ```bash
   rsync -avP 源文件夹/ 目标文件夹/
   ```.
   Подходит для: передачи в условиях нестабильной сетевой среды

### Сохранение оригинальных временных меток и атрибутов

Иногда вы можете обнаружить, что время модификации файла становится текущим временем после синхронизации. Этого можно избежать, если использовать правильные опции:

```bash
rsync -avt 源文件夹/ 目标文件夹/
```.

среди прочих:
- `-t` используется исключительно для сохранения времени модификации файла

Для пользователей Mac можно добавить опцию `-E`, чтобы сохранить специфические для macOS атрибуты файла:

```bash
rsync -avtE 源文件夹/ 目标文件夹/
```

### Зеркальная синхронизация (удаление лишних файлов с целевого диска)

Если вы хотите, чтобы целевая папка полностью совпадала с исходной (удалите из целевой папки файлы, которых нет в исходной):

```bash
rsync -av --delete 源文件夹/ 目标文件夹/
```.

⚠️ Будьте осторожны с параметром `--delete`, который удаляет в целевой папке файлы, отсутствующие в исходной папке.

### Сначала протестируйте, затем выполните

Вы можете использовать параметр `--dry-run` для проверки перед выполнением критической синхронизации:

```bash
rsync -av --dry-run 源文件夹/ 目标文件夹/
```.

Это покажет операцию, которая будет выполнена, но не выполнит ее на самом деле.

### Исключить определенные файлы или папки

Исключите файлы, которые не нужно синхронизировать:

```bash
rsync -av --exclude='*.tmp' --exclude='temp/' 源文件夹/ 目标文件夹/
```

## Как работает rsync: понимание принципа

rsync эффективен, потому что использует умный алгоритм для распознавания изменений файлов.

```mermaid
flowchart TD
    A[开始同步] --> B{检查文件是否存在于目标}
    B -->|否| C[完整复制文件]
    B -->|是| D{检查文件大小和修改时间}
    D -->|不同| E[计算文件差异]
    D -->|相同| F[跳过文件]
    E --> G{传输差异块}
    G --> H[在目标重建完整文件]
    C --> Z[继续下一个文件]
    F --> Z
    H --> Z
    Z --> I{还有更多文件?}
    I -->|是| B
    I -->|否| J[同步完成]
```.

При такой инкрементной передаче передается только та часть файла, которая изменилась, что значительно повышает эффективность. Например, если в файле объемом 10 ГБ изменилось всего несколько МБ, rsync передаст только эти несколько МБ данных.

## Лучшие практики для распространенных сценариев

### Сценарий 1: Резервное копирование важных документов

Сохраните все атрибуты и покажите общий прогресс:

```bash
rsync -avE --info=progress2 ~/Documents/ /Volumes/Backup/Documents/
```.

### Сценарий 2: Синхронизация папок между двумя компьютерами Mac

Сетевое окружение нестабильно и требует прерывистой и сжатой передачи данных:

```bash
rsync -avzP ~/Projects/ user@remote-mac:~/Projects/
```.

### Сценарий 3: Создание полностью зеркального резервного копирования

Полная синхронизация зеркал с сохранением всех атрибутов:

```bash
rsync -avE --delete --info=progress2 ~/Pictures/ /Volumes/Backup/Pictures/
```.

## Устранение общих проблем

1. **Проблемы с правами доступа к файлам**: Если вы столкнулись с ошибкой прав доступа, попробуйте выполнить команду с `sudo`.
2. **Изменения временной метки**: убедитесь, что вы используете опции `-a` или `-t`.
3. **Слишком медленно**: добавьте опцию `-z`, чтобы включить сжатие.
4. **Дополнительные опции не найдены**: проверьте версию rsync, возможно, потребуется обновление

## Резюме

rsync - это очень мощный инструмент синхронизации файлов, освоение которого может значительно повысить эффективность управления файлами. Я надеюсь, что это руководство поможет вам полностью использовать потенциал rsync: от простых резервных копий до сложных удаленных синхронизаций, от базового использования до расширенных опций.

Если вы дизайнер, которому необходимо создать резервную копию своей работы, бухгалтер, которому нужно сохранить финансовые данные, или студент, которому нужно синхронизировать учебные материалы на нескольких устройствах, rsync удовлетворит все ваши ожидания от синхронизации файлов.

## Подумайте о проблеме

Если вы регулярно синхронизируете файлы между несколькими устройствами, попробуйте создать простой сценарий для автоматизации этого процесса. Как вы думаете, каковы преимущества и недостатки rsync по сравнению с другими программами для резервного копирования при выполнении регулярных задач резервного копирования? Как на практике вы будете балансировать между автоматизацией и безопасностью данных?
