---
title: "Как изящно завершить миграцию сайта, если DNS-провайдер не поддерживает 301 редирект?"
date: 2025-02-20T21:26:37+04:00
slug: "domain-redirect-without-dns-support"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250220213019741.webp"
tags:
  - "Перенос веб-сайта"
  - "перенаправление домена"
  - "Техническая программа"
---

Приходилось ли вам сталкиваться с ситуацией, когда ваш сайт необходимо перенести на новое доменное имя, но поставщик услуг доменных имен не поддерживает 301 редирект на уровне DNS? В этой статье мы расскажем о простом и элегантном решении для плавного перенаправления посетителей вашего сайта на новый домен.

<! -еще-->

## Фон

Перенос домена - распространенное требование при обслуживании веб-сайта. Традиционной практикой является настройка 301 редиректа у поставщика услуг DNS для постоянного перенаправления запросов к старому домену на новый домен. Однако не все поставщики услуг DNS поддерживают эту функцию. Даже известные поставщики услуг иногда не предоставляют эту услугу по разным причинам.

## Анализ проблемы

Когда поставщики услуг DNS не поддерживают 301 перенаправление, мы сталкиваемся со следующими проблемами:

1. как сделать так, чтобы пользователи, посещающие старое доменное имя, могли плавно перейти на новое доменное имя?
2. как сохранить постоянство пути URL, чтобы при посещении определенной страницы старого доменного имени пользователи могли перейти на соответствующую страницу нового доменного имени?
3. как сделать так, чтобы поисковые системы правильно поняли смену домена?

## Решение

Мы можем выполнить это требование с помощью комбинации HTML и JavaScript. В частности, нам нужно:

1. создать простую HTML-страницу, содержащую функцию автоматического перехода
2. добавить SEO-разметку, чтобы помочь поисковым системам понять изменения
3. убедиться, что страница работает во всех ситуациях

Ниже приведен полный код реализации:

```html
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网站已迁移到新域名</title>
    <link rel="canonical" href="https://新域名.com">
    <meta http-equiv="refresh" content="0; url=https://新域名.com">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        .message {
            margin-top: 2rem;
        }
        .redirect-link {
            color: #0366d6;
            text-decoration: none;
        }
        .redirect-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="message">
        <h1>本站点已迁移</h1>
        <p>页面正在自动跳转到新网址：<a class="redirect-link" href="https://新域名.com">https://新域名.com</a></p>
        <p>如果没有自动跳转，请点击上面的链接访问新网站。</p>
    </div>
    <script>
        // 只在有效的网站路径时添加路径
        var path = window.location.pathname;
        // 如果路径是无效的（比如本地文件路径），就跳转到主页
        if (path.includes('Users') || path.includes('/dev/')) {
            window.location.href = 'https://新域名.com';
        } else {
            window.location.href = 'https://新域名.com' + path;
        }
    </script>
</body>
</html>
```.

## Анализ кода

Это решение содержит несколько ключевых частей:

1. **Мета-тег Refresh**:
   ```html
   <meta http-equiv="refresh" content="0; url=https://新域名.com">
   ```.
   Это самая базовая форма перенаправления, которая работает, даже если JavaScript отключен.

2. **Канонический тег**:
   ```html
   <link rel="canonical" href="https://新域名.com">
   ```
   Сообщает поисковым системам новый адрес канонической ссылки.

3. **JavaScript редирект**:
   ```javascript
   window.location.href = 'https://新域名.com' + path;
   ```.
   Обеспечивает более разумное сохранение пути, чтобы гарантировать, что пользователи будут перенаправлены на нужную страницу.

4. **BLACKUP**:
   Страница содержит четкий текст предупреждения и кликабельные ссылки на случай, если автоматический переход не сработает.

## Шаги развертывания

1. создайте файл index.html:
   ```fish
   echo 'HTML内容' > index.html
   ```.

2. При использовании GitHub Pages:
   ```fish
   git fetch origin gh-pages
   git checkout gh-pages
   git add index.html
   git commit -m "feat: redirect to new domain"
   git push origin gh-pages
   ```

## Примечания

1. Перед развертыванием создайте резервную копию всего содержимого старого сайта.
2. убедитесь, что новый домен полностью настроен и доступен.
3. протестируйте различные сценарии доступа:
   - Прямой доступ к основному доменному имени
   - Доступ к определенным страницам статей
   - Отключение JavaScript
   - Доступ с мобильных устройств

4. настройка Google Search Console, чтобы поисковые системы быстрее поняли изменения

## Расширенное мышление

Хотя это не "настоящий" HTTP 301 редирект, данное решение предлагает несколько существенных преимуществ:

1. **Простота реализации**: требуется только один HTML-файл.
2. **Нулевая стоимость**: не требуется поддержка дополнительных серверов или CDN.
3. **Высокая надежность**: надежность скачки обеспечивается многочисленными защитными механизмами
4. **Хорошая совместимость**: применимо к различным браузерам и сценариям доступа

## Резюме

Когда DNS-провайдеры не поддерживают 301-ю переадресацию, использование HTML+JavaScript является простой и эффективной альтернативой. Хотя это не самый идеальный технический выбор, в определенных сценариях это решение может удовлетворить потребности и помочь веб-сайтам завершить миграцию доменных имен.

Помните: миграция сайта - это не только технология, но и удобство для пользователя. Сделать процесс миграции незаметным для пользователя с помощью разумных подсказок и плавных переходов - вот конечная цель.
