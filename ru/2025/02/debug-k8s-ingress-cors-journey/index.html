<!doctype html><html lang=ru-RU x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Начало работы с Kubernetes в действии: устранение неполадок в междоменном путешествии по созданию отчетов об ошибках | ЛюбимРешать</title><link href=/favicon.ico rel=icon type=image/x-icon><link rel=canonical href=https://jiejue.ai/ru/2025/02/debug-k8s-ingress-cors-journey/><meta name=author content="董昊"><meta name=description content="Как разработчик, вы когда-нибудь сталкивались с ситуацией, когда в коде нет никаких изменений, конфигурация вроде бы правильная, но сервис вдруг не работает? Сегодня я хочу поделиться с вами реальным случаем отладки кросс-доменных проблем в среде Kubernetes и надеюсь вдохновить вас на решение аналогичной проблемы.
"><meta name=keywords content="Kubernetes,Скрининг Проблем,Ретикуляция,Обмен Опытом"><meta name=generator content="Hugo 0.148.2"><meta property="og:url" content="https://jiejue.ai/ru/2025/02/debug-k8s-ingress-cors-journey/"><meta property="og:site_name" content="ЛюбимРешать"><meta property="og:title" content="Начало работы с Kubernetes в действии: устранение неполадок в междоменном путешествии по созданию отчетов об ошибках"><meta property="og:description" content="Как разработчик, вы когда-нибудь сталкивались с ситуацией, когда в коде нет никаких изменений, конфигурация вроде бы правильная, но сервис вдруг не работает? Сегодня я хочу поделиться с вами реальным случаем отладки кросс-доменных проблем в среде Kubernetes и надеюсь вдохновить вас на решение аналогичной проблемы."><meta property="og:locale" content="ru_RU"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-14T17:05:31+04:00"><meta property="article:modified_time" content="2025-08-13T15:03:02+00:00"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Скрининг Проблем"><meta property="article:tag" content="Ретикуляция"><meta property="article:tag" content="Обмен Опытом"><meta name=twitter:card content="summary"><meta name=twitter:title content="Начало работы с Kubernetes в действии: устранение неполадок в междоменном путешествии по созданию отчетов об ошибках"><meta name=twitter:description content="Как разработчик, вы когда-нибудь сталкивались с ситуацией, когда в коде нет никаких изменений, конфигурация вроде бы правильная, но сервис вдруг не работает? Сегодня я хочу поделиться с вами реальным случаем отладки кросс-доменных проблем в среде Kubernetes и надеюсь вдохновить вас на решение аналогичной проблемы."><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js integrity="sha256-PtHu0lJIiSHfZeNj1nFd6wTX+Squ255SGZ/fc8seCtM=" crossorigin=anonymous></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title=Повернуть!><div class="h-10 rounded-full"><img src=/favicon.ico alt=爱解决></div></div><div><a href=/ru class="text-lg font-semibold cursor-pointer">爱解决</a><div class="text-base-content/60 text-sm">用AI为人民服务</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/ru/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/ru/posts title=Архивы><ion-icon name=archive></ion-icon>Архивы</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/ru/tags title="Все теги"><ion-icon name=pricetags></ion-icon>Все теги</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/ru/index.xml title=RSS><ion-icon class=group-hover:text-primary-content name=logo-rss></ion-icon></a><div class="dropdown dropdown-end dropdown-hover"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option"><ion-icon class="group-hover:text-primary-content text-xl" name=menu></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-xl"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/ru/posts title=Архивы><ion-icon name=archive></ion-icon>Архивы</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/ru/tags title="Все теги"><ion-icon name=pricetags></ion-icon>Все теги</a></li></ul></div><div class="dropdown dropdown-end dropdown-hover language-switcher"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" title="Переключить язык"><ion-icon class=group-hover:text-primary-content name=language-outline></ion-icon><span class="ml-1 hidden md:inline group-hover:text-primary-content language-name">Русский</span></div><ul tabindex=0 class="dropdown-content menu bg-base-100 rounded-box z-[1] shadow-xl border border-base-content/20" style=min-width:6rem;width:auto><li><a href=/zh/2025/02/debug-k8s-ingress-cors-journey/ class="flex items-center gap-2"><span class="flag flag-cn"></span>
<span class=language-name>中文</span></a></li></ul></div></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="Начало работы с Kubernetes в действии: устранение неполадок в междоменном путешествии по созданию отчетов об ошибках"><meta itemprop=description content="Как разработчик, вы когда-нибудь сталкивались с ситуацией, когда в коде нет никаких изменений, конфигурация вроде бы правильная, но сервис вдруг не работает? Сегодня я хочу поделиться с вами реальным случаем отладки кросс-доменных проблем в среде Kubernetes и надеюсь вдохновить вас на решение аналогичной проблемы."><meta itemprop=datePublished content="2025-02-14T17:05:31+04:00"><meta itemprop=dateModified content="2025-08-13T15:03:02+00:00"><meta itemprop=wordCount content="4425"><meta itemprop=keywords content="Kubernetes,Скрининг Проблем,Ретикуляция,Обмен Опытом"><header><h1 itemprop=headline>Начало работы с Kubernetes в действии: устранение неполадок в междоменном путешествии по созданию отчетов об ошибках</h1><p class=text-sm><span data-format=luxon>2025-02-14T17:05:31+04:00</span>
| <span>9 минут чтения</span>
| <span>Обновлено
<span data-format=luxon>2025-08-13T15:03:02Z</span></span></p><div class="flex justify-between"><div class="flex items-center"><span>@</span>
<span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>董昊</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=%d0%9d%d0%b0%d1%87%d0%b0%d0%bb%d0%be%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b%20%d1%81%20Kubernetes%20%d0%b2%20%d0%b4%d0%b5%d0%b9%d1%81%d1%82%d0%b2%d0%b8%d0%b8:%20%d1%83%d1%81%d1%82%d1%80%d0%b0%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%bd%d0%b5%d0%bf%d0%be%d0%bb%d0%b0%d0%b4%d0%be%d0%ba%20%d0%b2%20%d0%bc%d0%b5%d0%b6%d0%b4%d0%be%d0%bc%d0%b5%d0%bd%d0%bd%d0%be%d0%bc%20%d0%bf%d1%83%d1%82%d0%b5%d1%88%d0%b5%d1%81%d1%82%d0%b2%d0%b8%d0%b8%20%d0%bf%d0%be%20%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8e%20%d0%be%d1%82%d1%87%d0%b5%d1%82%d0%be%d0%b2%20%d0%be%d0%b1%20%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b0%d1%85&amp;url=https://jiejue.ai/ru/2025/02/debug-k8s-ingress-cors-journey/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://jiejue.ai/ru/2025/02/debug-k8s-ingress-cors-journey/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://wa.me/?text=%d0%9d%d0%b0%d1%87%d0%b0%d0%bb%d0%be%20%d1%80%d0%b0%d0%b1%d0%be%d1%82%d1%8b%20%d1%81%20Kubernetes%20%d0%b2%20%d0%b4%d0%b5%d0%b9%d1%81%d1%82%d0%b2%d0%b8%d0%b8:%20%d1%83%d1%81%d1%82%d1%80%d0%b0%d0%bd%d0%b5%d0%bd%d0%b8%d0%b5%20%d0%bd%d0%b5%d0%bf%d0%be%d0%bb%d0%b0%d0%b4%d0%be%d0%ba%20%d0%b2%20%d0%bc%d0%b5%d0%b6%d0%b4%d0%be%d0%bc%d0%b5%d0%bd%d0%bd%d0%be%d0%bc%20%d0%bf%d1%83%d1%82%d0%b5%d1%88%d0%b5%d1%81%d1%82%d0%b2%d0%b8%d0%b8%20%d0%bf%d0%be%20%d1%81%d0%be%d0%b7%d0%b4%d0%b0%d0%bd%d0%b8%d1%8e%20%d0%be%d1%82%d1%87%d0%b5%d1%82%d0%be%d0%b2%20%d0%be%d0%b1%20%d0%be%d1%88%d0%b8%d0%b1%d0%ba%d0%b0%d1%85%20https://jiejue.ai/ru/2025/02/debug-k8s-ingress-cors-journey/" target=_blank rel="noopener noreferrer" title="Share on WhatsApp"><ion-icon class=group-hover:text-primary-content name=logo-whatsapp></ion-icon></a></div></div></header><section id=dream-single-post-content itemprop=articleBody><img class="w-full z-30" src=https://jiejue.obs.ap-southeast-1.myhuaweicloud.com/20250214170724294.webp alt="Начало работы с Kubernetes в действии: устранение неполадок в междоменном путешествии по созданию отчетов об ошибках"><p>Как разработчик, вы когда-нибудь сталкивались с ситуацией, когда в коде нет никаких изменений, конфигурация вроде бы правильная, но сервис вдруг не работает? Сегодня я хочу поделиться с вами реальным случаем отладки кросс-доменных проблем в среде Kubernetes и надеюсь вдохновить вас на решение аналогичной проблемы.</p><p>&lt;! &ndash;подробнее&ndash;></p><h2 id=история-проблемы>История проблемы</h2><p>Наше веб-приложение развернуто на Azure Kubernetes Service (AKS) и изначально было спроектировано следующим образом:</p><pre tabindex=0><code>用户请求 -&gt; Application Gateway -&gt; Service -&gt; Pod
</code></pre><p>Чтобы оптимизировать производительность, нам нужно добавить слой Nginx Ingress в середине. Изменения в архитектуре следующие:</p><pre class=mermaid>
  graph TB
    User((用户))
    AppGW[Application Gateway]
    Ingress[Nginx Ingress]
    Svc[Service]
    Pod[Pod]

    subgraph 原架构
        User --&gt;|1.请求| AppGW
        AppGW --&gt;|2.转发| Svc
        Svc --&gt;|3.路由| Pod
    end

    subgraph 新架构
        User --&gt;|1.请求| AppGW
        AppGW --&gt;|2.转发| Ingress
        Ingress --&gt;|3.路由| Svc
        Svc --&gt;|4.转发| Pod
    end

    style User fill:#f9f,stroke:#333,stroke-width:2px
    style AppGW fill:#bbf,stroke:#333,stroke-width:2px
    style Ingress fill:#bfb,stroke:#333,stroke-width:2px
    style Svc fill:#fbb,stroke:#333,stroke-width:2px
    style Pod fill:#bff,stroke:#333,stroke-width:2px
</pre><p>После завершения настройки мы обнаружили, что браузер сообщает об ошибке CORS (cross domain). Это кажется простой проблемой, но решение довольно интересное.</p><h2 id=первая-попытка-добавление-конфигурации-cors>Первая попытка: добавление конфигурации CORS</h2><p>В качестве &ldquo;стандартной практики&rdquo; для решения проблем с кросс-доменами мы сначала попробовали добавить настройки, связанные с CORS, в конфигурацию Ingress:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/enable-cors</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/cors-allow-origin</span>: <span style=color:#e6db74>&#34;https://我们的前端域名&#34;</span>
</span></span></code></pre></div><p>Результат: Неудача. Браузер по-прежнему сообщает об ошибке кросс-домена.</p><h2 id=глубокое-устранение-неполадок-мыслим-системно>Глубокое устранение неполадок: мыслим системно</h2><p>На этом этапе мы начинаем анализировать проблему системно:</p><ol><li>изучите ответ на запрос OPTIONS (запрос предварительной проверки):</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X OPTIONS -I <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Origin: https://我们的前端域名&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -H <span style=color:#e6db74>&#34;Access-Control-Request-Method: POST&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  https://我们的后端域名
</span></span><span style=display:flex><span><span style=color:#e6db74>```</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Результат возврата выглядит корректным и содержит все необходимые CORS-заголовки.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2. просмотрите журналы Nginx Ingress:
</span></span><span style=display:flex><span><span style=color:#e6db74>```</span>bash
</span></span><span style=display:flex><span>kubectl -n ingress命名空间 logs -l app<span style=color:#f92672>=</span>nginx-internal-0 -f
</span></span></code></pre></div><p>В логах было обнаружено ключевое сообщение: запрос был перенаправлен на неожиданный сервис <code>[app2-app2-service-80]</code> вместо ожидаемого <code>app1-service</code>.</p><h2 id=правда-неожиданный-конфликт-конфигурации>Правда: неожиданный конфликт конфигурации</h2><p>Проанализировав журналы, мы обнаружили забытую конфигурацию Ingress, которая влияла на работу нашего сервиса. Это похоже на то, как если бы сигналу вашего домашнего WiFi мешал соседский роутер - две конфигурации &ldquo;борются&rdquo; в одной среде.</p><p>В Azure AKS все Ingress&rsquo;ы имеют один и тот же IP-адрес, а это значит, что конфигурации Ingress&rsquo;ов из разных проектов могут влиять друг на друга. Мы обнаружили, что неиспользуемая конфигурация <code>app2-ingress</code> все еще существовала и мешала маршрутизации наших запросов.</p><h2 id=решение-упростить>Решение: Упростить</h2><p>Окончательное решение состоит из трех ключевых шагов:</p><ol><li>Исправьте конфигурацию пути проникновения:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/(.*)</span> <span style=color:#75715e># 使用通配符匹配所有路径</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app1-service</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>nginx.ingress.kubernetes.io/rewrite-target</span>: <span style=color:#ae81ff>/$1</span> <span style=color:#75715e># 保证路径正确转发</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>```.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>2. Удалите конфигурацию Ingress, которая больше не используется</span>:
</span></span><span style=display:flex><span><span style=color:#ae81ff>```bash</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>kubectl delete ingress app2-ingress -n app2 </span>
</span></span></code></pre></div><ol start=3><li>удалите все добавленные вручную конфигурации CORS (пусть бэкэнд-сервис сам справляется с кросс-доменом).</li></ol><p>Особое внимание обратите на конфигурацию пути в первом шаге:</p><ul><li><code>path: /(.*)</code> используется для соответствия всем путям запроса.</li><li><code>rewrite-target: /$1</code> гарантирует, что запросы будут корректно перенаправлены на внутренний сервис, сохраняя оригинальный путь нетронутым.</li><li>Без этой настройки все запросы могут быть перенаправлены на корневой путь <code>/</code>, что приведет к неправильной работе APP1</li></ul><p>Проблема решена!</p><h2 id=извлеченные-уроки>Извлеченные уроки.</h2><p>Этот процесс устранения неисправностей можно обобщить в виде следующей схемы:</p><pre class=mermaid>
  mindmap
  root((CORS问题))
    配置检查
      路径配置
        检查path规则
        添加rewrite-target
      CORS配置
        尝试添加CORS注解
        发现反而有干扰
    日志分析
      检查OPTIONS请求
        响应状态码
        CORS响应头
      观察Nginx日志
        上游服务名称
        请求转发路径
    环境排查
      发现冗余配置
        遗留的app2-ingress
        共享IP地址的影响
      清理环境
        删除无用ingress
        简化CORS配置
    最终方案
      正确的path配置
        使用/(.*)
        添加rewrite-target
      移除CORS注解
        让后端处理跨域
        保持配置简单
      清理冗余配置
        删除app2-ingress
        避免规则冲突
```.

Этот опыт поиска и устранения неисправностей преподал нам несколько важных уроков:

1. **Важно смотреть на журналы**.
   - Каждая деталь в журналах может быть подсказкой.
   - Обратите особое внимание на то, к какой службе был направлен запрос (информация о восходящем потоке).

2. **Понимание характеристик среды
   - В AKS один и тот же Ingress Controller использует один IP.
   - В AKS один и тот же Ingress Controller использует один IP, что означает, что конфигурации Ingress из разных проектов могут взаимодействовать друг с другом.
   - Уделите особое внимание очистке конфигураций, которые больше не используются

3. ** Чем проще конфигурация, тем лучше.
   - Иногда &#34;дополнительный уровень защиты&#34; может все усложнить.
   - Если бэкэнд-сервис уже корректно обрабатывает CORS, не стоит настраивать его еще раз на уровне Ingress!

4. **Системное мышление
   - Проблема может быть не там, где вы ее сначала заподозрили.
   - Изучите каждый шаг за шагом, ищите аномалии.

## Практический совет

Если вы столкнулись с подобными проблемами в своей среде Kubernetes, вы можете следовать этому процессу для устранения неполадок:

1. просмотрите журналы, обращая особое внимание на пути, по которым перенаправляются запросы
2. проверьте все соответствующие конфигурации, включая старые конфигурации, которые кажутся неактуальными.
3. начните с простого решения
4. поддерживайте чистоту среды, своевременно удаляйте неиспользуемые конфигурации

В заключение я хотел бы сказать, что в архитектуре микросервисов проблемы часто не так просты, как кажутся. Но если мы сохраняем терпение и систематически анализируем их, мы обязательно найдем решение. Процесс отладки иногда разочаровывает, но каждое успешное устранение неполадок дает нам более глубокое понимание системы.

Надеюсь, эта статья поможет вам просветиться, когда вы столкнетесь с подобными проблемами. Если у вас есть похожий опыт или другие идеи, не стесняйтесь делиться ими в разделе комментариев!
</pre></section><div class=divider></div><div class="flex flex-col md:flex-row justify-between gap-4 py-4"><a role=button class="btn btn-outline h-12" href=/ru/2025/02/git-rescue-wrong-commit/ title="Git на помощь: как отсоединить файл от недавнего коммита"><ion-icon name=chevron-back></ion-icon><div class="inline-flex flex-col items-start"><span class="text-base-content/60 text-xs font-normal">Предыдущая</span>
<span class="max-w-48 truncate">Git на помощь: как отсоединить файл от недавнего коммита</span></div></a><a role=button class="btn btn-outline h-12" href=/ru/2025/02/future-car-as-platform/ title="Новая эра автомобиля: эволюция от транспортного средства к платформе для образа жизни"><div class="inline-flex flex-col items-end"><span class="text-base-content/60 text-xs font-normal">Следующая</span>
<span class="max-w-48 truncate">Новая эра автомобиля: эволюция от транспортного средства к платформе для образа жизни</span></div><ion-icon name=chevron-forward></ion-icon></a></div><div class=divider></div><section class=space-y-4><article><div id=tcomment></div><script src=https://cdn.jsdelivr.net/npm/twikoo@1.6.41/dist/twikoo.min.js></script><script>twikoo.init({envId:"https://6dhzwvtyqz753zhpkrvnnydhlm0vubmy.lambda-url.ap-east-1.on.aws/",el:"#tcomment",region:"ap-east-1",path:"/ru/2025/02/debug-k8s-ingress-cors-journey/",lang:"zh-CN"})</script></article></section></article></div><div x-data=tocHighlighter() @scroll.window=debouncedScroll class="hidden lg:flex lg:flex-col lg:items-end"><nav id=TableOfContents><ul><li><a href=#история-проблемы>История проблемы</a></li><li><a href=#первая-попытка-добавление-конфигурации-cors>Первая попытка: добавление конфигурации CORS</a></li><li><a href=#глубокое-устранение-неполадок-мыслим-системно>Глубокое устранение неполадок: мыслим системно</a></li><li><a href=#правда-неожиданный-конфликт-конфигурации>Правда: неожиданный конфликт конфигурации</a></li><li><a href=#решение-упростить>Решение: Упростить</a></li><li><a href=#извлеченные-уроки>Извлеченные уроки.</a></li></ul></nav></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>© 2025 ЛюбимРешать</p><p>一个热爱解决问题的网站</p></div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><section><span id=busuanzi_container_value_site_pv><i class="far fa-eye fa-fw"></i>
本站总访问量 <span id=busuanzi_value_site_pv></span>
</span>&nbsp;|&nbsp;
<span id=busuanzi_container_value_site_uv><i class="fa fa-user"></i>
本站访客数 <span id=busuanzi_value_site_uv></span></span></section></span></section></script><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>© 2025 ЛюбимРешать</p><p>一个热爱解决问题的网站</p></div><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><section><span id=busuanzi_container_value_site_pv><i class="far fa-eye fa-fw"></i>
本站总访问量 <span id=busuanzi_value_site_pv></span>
</span>&nbsp;|&nbsp;
<span id=busuanzi_container_value_site_uv><i class="fa fa-user"></i>
本站访客数 <span id=busuanzi_value_site_uv></span></span></section></span></section></script><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/js/grid.min.js></script><script src=/js/main.min.js></script><script src=https://cdn.jsdelivr.net/npm/luxon@1.26.0 integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin=anonymous></script><script>format();function format(){document.querySelectorAll('span[data-format="luxon"]').forEach(e=>{const t=e.textContent;e.textContent=luxon.DateTime.fromISO(t,{locale:"ru"}).toFormat("yyyy年MM月dd日 HH:mm")})}</script><script src=/js/toc.min.js></script><script type=module>
      import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
      mediumZoom('#dream-single-post-content img', {
        background: 'oklch(var(--b1))',
        margin: 24,
      })
    </script><script type=module>
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
      </script><script async src="https://www.googletagmanager.com/gtag/js?id=G-S0KCH9BW4F"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-S0KCH9BW4F")}</script><script type=module src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin=anonymous></script><script nomodule src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin=anonymous></script></body></html>